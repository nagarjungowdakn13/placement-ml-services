services:
  - type: static_site
    name: placement-frontend
    plan: free
    buildCommand: cd frontend && npm ci && npm run build
    publishPath: frontend/dist
    # Note: Static site builds at build time. If using fromService here,
    # ensure dependent service exists or set this manually after first deploy.
    # envVars:
    #   - key: VITE_API_URL
    #     fromService:
    #       type: web
    #       name: placement-backend
    #       property: url
    autoDeploy: true

  - type: web
    name: placement-backend
    env: node
    plan: free
    buildCommand: cd backend && npm ci && npm run build
    startCommand: node backend/dist/app.js
    healthCheckPath: /health
    envVars:
      - key: NLP_SERVICE_URL
        fromService:
          type: web
          name: resume-nlp
          property: url
      - key: CF_SERVICE_URL
        fromService:
          type: web
          name: collaborative-filter
          property: url
      - key: PLACEMENT_SERVICE_URL
        fromService:
          type: web
          name: placement-predict
          property: url
    autoDeploy: true

  - type: web
    name: resume-nlp
    env: python
    plan: free
    buildCommand: |
      cd ml-service/resume-nlp && pip install -r requirements.txt
    startCommand: |
      cd ml-service/resume-nlp && uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars: []
    autoDeploy: true

  - type: web
    name: collaborative-filter
    env: python
    plan: free
    buildCommand: |
      cd ml-service/collaborative-filter && pip install -r requirements.txt
    startCommand: |
      cd ml-service/collaborative-filter && uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars: []
    autoDeploy: true

  - type: web
    name: placement-predict
    env: python
    plan: free
    buildCommand: |
      cd ml-service/placement-predict && pip install -r requirements.txt
    startCommand: |
      cd ml-service/placement-predict && uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars: []
    autoDeploy: true
